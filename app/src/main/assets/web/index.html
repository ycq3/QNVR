<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QNVR 预览与配置</title>
  <style>
    body { font-family: system-ui; padding: 12px; }
    img { width: 100%; max-width: 640px; background: #000; }
    .row { margin: 8px 0; }
    label { display: inline-block; width: 100px; }
  </style>
  <script>
    async function refresh() {
      const s = await fetch('/api/status').then(r=>r.json())
      document.getElementById('rtsp').textContent = s.rtsp
    }
    async function applyCfg() {
      const torch = document.getElementById('torch').checked
      const watermark = document.getElementById('watermark').checked
      const zoom = parseFloat(document.getElementById('zoom').value)
      await fetch('/api/config', {method:'POST', body: JSON.stringify({torch, watermark, zoom})})
    }
    function startPreview() {
      const img = document.getElementById('mjpeg')
      img.src = '/stream.mjpg'
    }
    window.onload = ()=>{ refresh(); startPreview(); }
  </script>
</head>
<body>
  <h2>QNVR 预览</h2>
  <img id="mjpeg" alt="预览" />
  <div class="row">RTSP 地址：<span id="rtsp"></span></div>
  <h3>参数配置</h3>
  <div class="row"><label>手电筒</label><input id="torch" type="checkbox"></div>
  <div class="row"><label>时间水印</label><input id="watermark" type="checkbox" checked></div>
  <div class="row"><label>变焦</label><input id="zoom" type="range" min="1" max="4" step="0.1" value="1"></div>
  <button onclick="applyCfg()">应用</button>
</body>
</html>
